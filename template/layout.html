<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
	<title>{%block title%}{% endblock %}</title>
	<link rel="stylesheet" href="/static/css/ota.css">
	<style>
		::-webkit-file-upload-button {cursor:pointer;}
		html,body {width: 100%;height: 100%;}
		main {position: absolute;top: 0;left: 50px;right: 0;bottom: 0;overflow-y: scroll;padding: 50px 100px 0;-webkit-overflow-scrolling:touch;}
		h1 {margin-bottom: 30px;}
		.row {margin-bottom: 20px;}
		.input-field {width: 250px;padding: .5em 1em;}
		.user-avatar {margin-bottom: .1rem;padding: 5px;background: #fff;box-shadow: 0 0 10px rgba(110,110,110,.2);}
		.user-name {color: #333;font-size: 18px;font-weight: 600;}
		.user-info {font-size: 12px;}
		.user-info em {color: #E91E63;padding: 0 .2em;}
		.pop {box-shadow: 0 0 30px rgba(50,50,50,.7);padding: 50px 80px;background: #fff;}
		.pop a {border-bottom: none;}
		.pop a:hover {text-decoration: none;}
	</style>
	{% block header %}{% endblock %}
	<script src="/static/bower_components/ota.js/src/loader.js"></script>
	<script src="/static/bower_components/mustache.js/mustache.js"></script>
	<script>
		otaLoader({
			alias: {
				'Popbox': '/static/js/popbox.min.js'
			}
		})
	</script>
	{% if Login %}
	<script src="/static/js/socket.io.js"></script>
	<script>
		define('socket',function(exports){
			var socket = io.connect('http://127.0.0.1:10086')
			exports.socket = socket
		})
	</script>
	{% endif %}
</head>
<body>
{% include 'block/nav.html' %}
{% if Login %}
<script>
	require(['socket','mainPage','core'],function(socket,mainPage,ota){
		var socket = socket.socket,
			user = ota.getCookie('pyname')
		socket.on('recive',function(e){
			mainPage.updateNotify(1)
			mainPage.updateNotifyData(e)
		})
		socket.emit('add',user)
	})
</script>
{% endif %}
{% block content %}
{% endblock %}
</body>
{% if Login %}
<script>
	// getMessage
	require(['core','mainPage'],function(ota,mainPage){
		var ajax = ota.ajax
		if(ota.getCookie('pyname')){
			ajax({
				url: '/api/msg',
				dataType: 'json',
				success: function(data){
					if(data.count){
						mainPage.updateNotify(data.count)
					}
					mainPage.storeNotify(data)
				}
			})
		}
	})
</script>
{% endif %}
{% block footer %}
{% endblock %}
</html>